Evaluating baseline model on evaluation dataset
  0%|          | 0/10 [00:00<?, ?it/s] 10%|█         | 1/10 [00:01<00:10,  1.14s/it] 20%|██        | 2/10 [00:02<00:09,  1.16s/it] 30%|███       | 3/10 [00:03<00:07,  1.14s/it] 40%|████      | 4/10 [00:04<00:06,  1.13s/it] 50%|█████     | 5/10 [00:05<00:05,  1.12s/it] 60%|██████    | 6/10 [00:06<00:04,  1.12s/it] 70%|███████   | 7/10 [00:07<00:03,  1.12s/it] 80%|████████  | 8/10 [00:09<00:02,  1.13s/it] 90%|█████████ | 9/10 [00:10<00:01,  1.13s/it]100%|██████████| 10/10 [00:11<00:00,  1.08s/it]
Start train epoch 0, lr=0.0001 for run run_20210322T151142
  0%|          | 0/2500 [00:00<?, ?it/s][W ParallelNative.cpp:206] Warning: Cannot set number of intraop threads after parallel work has started or after set_num_threads call when using native parallel backend (function set_num_threads)
batch dict_keys(['loc', 'demand', 'depot'])
baseline <reinforce_baselines.WarmupBaseline object at 0x147f8b518>
epoch: 0, train_batch_id: 0, avg_cost: 14.032479286193848
grad_norm: 92.66744232177734, clipped: 1.0
Finished epoch 0, took 00:00:48 s
Saving model and state...

Validating...
  0%|          | 0/10 [00:00<?, ?it/s] 10%|█         | 1/10 [00:01<00:10,  1.19s/it] 20%|██        | 2/10 [00:02<00:09,  1.16s/it] 30%|███       | 3/10 [00:03<00:08,  1.16s/it] 40%|████      | 4/10 [00:04<00:07,  1.19s/it] 50%|█████     | 5/10 [00:05<00:05,  1.19s/it] 60%|██████    | 6/10 [00:07<00:04,  1.18s/it] 70%|███████   | 7/10 [00:08<00:03,  1.17s/it] 80%|████████  | 8/10 [00:09<00:02,  1.16s/it] 90%|█████████ | 9/10 [00:10<00:01,  1.20s/it]100%|██████████| 10/10 [00:11<00:00,  1.12s/it]
Validation overall avg_cost: 16.632600784301758 +- 0.04630681127309799
Evaluating candidate model on evaluation dataset
  0%|          | 0/10 [00:00<?, ?it/s] 10%|█         | 1/10 [00:01<00:10,  1.16s/it] 20%|██        | 2/10 [00:02<00:09,  1.15s/it] 30%|███       | 3/10 [00:03<00:07,  1.14s/it] 40%|████      | 4/10 [00:04<00:06,  1.14s/it] 50%|█████     | 5/10 [00:05<00:05,  1.15s/it] 60%|██████    | 6/10 [00:06<00:04,  1.13s/it] 70%|███████   | 7/10 [00:07<00:03,  1.12s/it] 80%|████████  | 8/10 [00:09<00:02,  1.12s/it] 90%|█████████ | 9/10 [00:10<00:01,  1.14s/it]100%|██████████| 10/10 [00:11<00:00,  1.07s/it]Epoch 0 candidate mean 16.74407958984375, baseline epoch 0 mean 19.922813415527344, difference -3.1787338256835938

p-value: 0.0
Update baseline
Evaluating baseline model on evaluation dataset
  0%|          | 0/10 [00:00<?, ?it/s] 10%|█         | 1/10 [00:01<00:10,  1.20s/it] 20%|██        | 2/10 [00:02<00:09,  1.18s/it] 30%|███       | 3/10 [00:03<00:08,  1.18s/it] 40%|████      | 4/10 [00:04<00:06,  1.16s/it] 50%|█████     | 5/10 [00:05<00:05,  1.15s/it] 60%|██████    | 6/10 [00:06<00:04,  1.13s/it] 70%|███████   | 7/10 [00:07<00:03,  1.13s/it] 80%|████████  | 8/10 [00:09<00:02,  1.12s/it] 90%|█████████ | 9/10 [00:10<00:01,  1.12s/it]100%|██████████| 10/10 [00:11<00:00,  1.05s/it]Set warmup alpha = 1.0

Start train epoch 1, lr=0.0001 for run run_20210322T151142
Evaluating baseline on dataset...
  0%|          | 0/1250 [00:00<?, ?it/s]  0%|          | 1/1250 [00:01<27:23,  1.32s/it]  0%|          | 2/1250 [00:02<27:05,  1.30s/it]  0%|          | 3/1250 [00:03<25:50,  1.24s/it]  0%|          | 4/1250 [00:04<24:58,  1.20s/it]  0%|          | 5/1250 [00:05<24:29,  1.18s/it]  0%|          | 6/1250 [00:07<24:04,  1.16s/it]  1%|          | 7/1250 [00:08<23:50,  1.15s/it]  1%|          | 8/1250 [00:09<23:31,  1.14s/it]  1%|          | 9/1250 [00:10<24:36,  1.19s/it]  1%|          | 10/1250 [00:11<24:09,  1.17s/it]  1%|          | 11/1250 [00:12<23:59,  1.16s/it]  1%|          | 12/1250 [00:13<23:39,  1.15s/it]  1%|          | 13/1250 [00:15<23:24,  1.14s/it]  1%|          | 14/1250 [00:16<23:32,  1.14s/it]  1%|          | 15/1250 [00:17<23:16,  1.13s/it]  1%|▏         | 16/1250 [00:18<23:12,  1.13s/it]  1%|▏         | 17/1250 [00:19<23:11,  1.13s/it]  1%|▏         | 18/1250 [00:20<23:08,  1.13s/it]  2%|▏         | 19/1250 [00:21<22:56,  1.12s/it]  2%|▏         | 20/1250 [00:22<22:48,  1.11s/it]  2%|▏         | 21/1250 [00:24<25:00,  1.22s/it]  2%|▏         | 22/1250 [00:25<24:23,  1.19s/it]  2%|▏         | 23/1250 [00:26<24:11,  1.18s/it]  2%|▏         | 24/1250 [00:28<25:09,  1.23s/it]  2%|▏         | 25/1250 [00:29<24:44,  1.21s/it]  2%|▏         | 26/1250 [00:30<26:27,  1.30s/it]  2%|▏         | 27/1250 [00:32<27:36,  1.35s/it]  2%|▏         | 28/1250 [00:33<26:28,  1.30s/it]  2%|▏         | 29/1250 [00:34<25:21,  1.25s/it]  2%|▏         | 30/1250 [00:35<24:25,  1.20s/it]  2%|▏         | 31/1250 [00:36<23:48,  1.17s/it]  3%|▎         | 32/1250 [00:37<24:30,  1.21s/it]  3%|▎         | 33/1250 [00:39<25:07,  1.24s/it]  3%|▎         | 34/1250 [00:40<25:22,  1.25s/it]  3%|▎         | 35/1250 [00:41<25:30,  1.26s/it]  3%|▎         | 36/1250 [00:43<25:31,  1.26s/it]  3%|▎         | 37/1250 [00:44<25:07,  1.24s/it]  3%|▎         | 38/1250 [00:45<24:23,  1.21s/it]  3%|▎         | 39/1250 [00:46<23:51,  1.18s/it]  3%|▎         | 40/1250 [00:47<23:19,  1.16s/it]  3%|▎         | 41/1250 [00:48<22:59,  1.14s/it]  3%|▎         | 42/1250 [00:49<22:48,  1.13s/it]  3%|▎         | 43/1250 [00:50<22:39,  1.13s/it]  4%|▎         | 44/1250 [00:52<22:30,  1.12s/it]  4%|▎         | 45/1250 [00:53<22:30,  1.12s/it]  4%|▎         | 46/1250 [00:54<22:30,  1.12s/it]  4%|▍         | 47/1250 [00:55<22:20,  1.11s/it]  4%|▍         | 48/1250 [00:56<22:15,  1.11s/it]  4%|▍         | 49/1250 [00:57<22:08,  1.11s/it]  4%|▍         | 50/1250 [00:58<22:06,  1.11s/it]  4%|▍         | 51/1250 [00:59<22:03,  1.10s/it]  4%|▍         | 52/1250 [01:00<22:29,  1.13s/it]  4%|▍         | 53/1250 [01:02<22:47,  1.14s/it]  4%|▍         | 54/1250 [01:03<22:58,  1.15s/it]  4%|▍         | 55/1250 [01:04<22:52,  1.15s/it]  4%|▍         | 56/1250 [01:05<22:38,  1.14s/it]  5%|▍         | 57/1250 [01:06<22:25,  1.13s/it]  5%|▍         | 58/1250 [01:07<22:14,  1.12s/it]  5%|▍         | 59/1250 [01:08<22:14,  1.12s/it]  5%|▍         | 60/1250 [01:10<22:33,  1.14s/it]  5%|▍         | 61/1250 [01:11<22:28,  1.13s/it]  5%|▍         | 62/1250 [01:12<22:20,  1.13s/it]  5%|▌         | 63/1250 [01:13<22:18,  1.13s/it]  5%|▌         | 64/1250 [01:14<22:08,  1.12s/it]  5%|▌         | 65/1250 [01:15<22:02,  1.12s/it]  5%|▌         | 66/1250 [01:16<21:57,  1.11s/it]  5%|▌         | 67/1250 [01:17<21:50,  1.11s/it]  5%|▌         | 68/1250 [01:18<21:46,  1.11s/it]  6%|▌         | 69/1250 [01:20<21:46,  1.11s/it]  6%|▌         | 70/1250 [01:21<21:53,  1.11s/it]  6%|▌         | 71/1250 [01:22<22:32,  1.15s/it]  6%|▌         | 72/1250 [01:23<23:20,  1.19s/it]  6%|▌         | 73/1250 [01:24<22:59,  1.17s/it]  6%|▌         | 74/1250 [01:25<22:44,  1.16s/it]  6%|▌         | 75/1250 [01:27<22:25,  1.15s/it]  6%|▌         | 76/1250 [01:28<22:33,  1.15s/it]  6%|▌         | 77/1250 [01:29<22:16,  1.14s/it]  6%|▌         | 78/1250 [01:30<22:06,  1.13s/it]  6%|▋         | 79/1250 [01:31<21:57,  1.12s/it]  6%|▋         | 80/1250 [01:32<21:51,  1.12s/it]  6%|▋         | 81/1250 [01:33<21:49,  1.12s/it]  7%|▋         | 82/1250 [01:34<21:51,  1.12s/it]  7%|▋         | 83/1250 [01:36<21:48,  1.12s/it]  7%|▋         | 84/1250 [01:37<22:10,  1.14s/it]  7%|▋         | 85/1250 [01:38<22:17,  1.15s/it]  7%|▋         | 86/1250 [01:39<22:06,  1.14s/it]  7%|▋         | 87/1250 [01:40<21:52,  1.13s/it]  7%|▋         | 88/1250 [01:41<21:40,  1.12s/it]  7%|▋         | 89/1250 [01:42<21:34,  1.12s/it]  7%|▋         | 90/1250 [01:43<21:33,  1.12s/it]  7%|▋         | 91/1250 [01:45<21:25,  1.11s/it]  7%|▋         | 92/1250 [01:46<21:21,  1.11s/it]  7%|▋         | 93/1250 [01:47<21:18,  1.10s/it]  8%|▊         | 94/1250 [01:48<21:17,  1.11s/it]  8%|▊         | 95/1250 [01:49<21:24,  1.11s/it]  8%|▊         | 96/1250 [01:50<21:32,  1.12s/it]  8%|▊         | 97/1250 [01:51<21:20,  1.11s/it]  8%|▊         | 98/1250 [01:52<21:13,  1.11s/it]  8%|▊         | 99/1250 [01:53<21:17,  1.11s/it]  8%|▊         | 100/1250 [01:55<21:11,  1.11s/it]  8%|▊         | 101/1250 [01:56<21:12,  1.11s/it]  8%|▊         | 102/1250 [01:57<21:46,  1.14s/it]  8%|▊         | 103/1250 [01:58<21:32,  1.13s/it]  8%|▊         | 104/1250 [01:59<21:23,  1.12s/it]  8%|▊         | 105/1250 [02:00<21:25,  1.12s/it]  8%|▊         | 106/1250 [02:01<21:33,  1.13s/it]  9%|▊         | 107/1250 [02:02<21:29,  1.13s/it]  9%|▊         | 108/1250 [02:04<21:47,  1.15s/it]  9%|▊         | 109/1250 [02:05<21:35,  1.14s/it]  9%|▉         | 110/1250 [02:06<21:30,  1.13s/it]  9%|▉         | 111/1250 [02:07<21:15,  1.12s/it]  9%|▉         | 112/1250 [02:08<21:07,  1.11s/it]  9%|▉         | 113/1250 [02:09<21:01,  1.11s/it]  9%|▉         | 114/1250 [02:10<21:13,  1.12s/it]  9%|▉         | 115/1250 [02:12<21:34,  1.14s/it]  9%|▉         | 116/1250 [02:13<21:40,  1.15s/it]  9%|▉         | 117/1250 [02:14<21:42,  1.15s/it]  9%|▉         | 118/1250 [02:15<21:31,  1.14s/it] 10%|▉         | 119/1250 [02:16<21:19,  1.13s/it] 10%|▉         | 120/1250 [02:17<21:17,  1.13s/it] 10%|▉         | 121/1250 [02:18<21:12,  1.13s/it] 10%|▉         | 122/1250 [02:19<21:08,  1.12s/it] 10%|▉         | 123/1250 [02:21<21:14,  1.13s/it] 10%|▉         | 124/1250 [02:22<21:22,  1.14s/it] 10%|█         | 125/1250 [02:23<22:07,  1.18s/it] 10%|█         | 126/1250 [02:24<23:02,  1.23s/it] 10%|█         | 127/1250 [02:25<22:18,  1.19s/it] 10%|█         | 128/1250 [02:27<21:59,  1.18s/it] 10%|█         | 129/1250 [02:28<22:10,  1.19s/it] 10%|█         | 130/1250 [02:29<22:10,  1.19s/it] 10%|█         | 131/1250 [02:30<21:41,  1.16s/it] 11%|█         | 132/1250 [02:31<21:17,  1.14s/it] 11%|█         | 133/1250 [02:32<21:06,  1.13s/it] 11%|█         | 134/1250 [02:33<21:02,  1.13s/it] 11%|█         | 135/1250 [02:35<20:55,  1.13s/it] 11%|█         | 136/1250 [02:36<21:50,  1.18s/it] 11%|█         | 137/1250 [02:37<21:35,  1.16s/it] 11%|█         | 138/1250 [02:38<21:15,  1.15s/it] 11%|█         | 139/1250 [02:39<20:56,  1.13s/it] 11%|█         | 140/1250 [02:40<20:47,  1.12s/it] 11%|█▏        | 141/1250 [02:41<20:39,  1.12s/it] 11%|█▏        | 142/1250 [02:42<20:31,  1.11s/it] 11%|█▏        | 143/1250 [02:44<20:28,  1.11s/it] 12%|█▏        | 144/1250 [02:45<20:25,  1.11s/it] 12%|█▏        | 145/1250 [02:46<20:21,  1.11s/it] 12%|█▏        | 146/1250 [02:47<20:17,  1.10s/it] 12%|█▏        | 147/1250 [02:48<20:17,  1.10s/it] 12%|█▏        | 148/1250 [02:49<20:28,  1.11s/it] 12%|█▏        | 149/1250 [02:50<20:22,  1.11s/it] 12%|█▏        | 150/1250 [02:51<20:22,  1.11s/it] 12%|█▏        | 151/1250 [02:52<20:17,  1.11s/it] 12%|█▏        | 152/1250 [02:54<20:22,  1.11s/it] 12%|█▏        | 153/1250 [02:55<20:17,  1.11s/it] 12%|█▏        | 154/1250 [02:56<20:15,  1.11s/it] 12%|█▏        | 155/1250 [02:57<20:10,  1.11s/it] 12%|█▏        | 156/1250 [02:58<20:10,  1.11s/it] 13%|█▎        | 157/1250 [02:59<20:07,  1.10s/it] 13%|█▎        | 158/1250 [03:00<20:16,  1.11s/it] 13%|█▎        | 159/1250 [03:01<20:19,  1.12s/it] 13%|█▎        | 160/1250 [03:02<20:13,  1.11s/it] 13%|█▎        | 161/1250 [03:04<20:09,  1.11s/it] 13%|█▎        | 162/1250 [03:05<20:14,  1.12s/it] 13%|█▎        | 163/1250 [03:06<20:09,  1.11s/it] 13%|█▎        | 164/1250 [03:07<20:05,  1.11s/it] 13%|█▎        | 165/1250 [03:08<20:03,  1.11s/it] 13%|█▎        | 166/1250 [03:09<19:59,  1.11s/it] 13%|█▎        | 167/1250 [03:10<20:38,  1.14s/it] 13%|█▎        | 168/1250 [03:11<20:28,  1.14s/it] 14%|█▎        | 169/1250 [03:13<21:00,  1.17s/it] 14%|█▎        | 170/1250 [03:14<21:27,  1.19s/it] 14%|█▎        | 171/1250 [03:15<21:03,  1.17s/it] 14%|█▍        | 172/1250 [03:16<21:46,  1.21s/it] 14%|█▍        | 173/1250 [03:18<21:22,  1.19s/it] 14%|█▍        | 174/1250 [03:19<21:11,  1.18s/it] 14%|█▍        | 175/1250 [03:20<20:47,  1.16s/it] 14%|█▍        | 176/1250 [03:21<20:28,  1.14s/it] 14%|█▍        | 177/1250 [03:22<20:16,  1.13s/it] 14%|█▍        | 178/1250 [03:23<21:01,  1.18s/it] 14%|█▍        | 179/1250 [03:24<21:07,  1.18s/it] 14%|█▍        | 180/1250 [03:26<21:20,  1.20s/it] 14%|█▍        | 181/1250 [03:27<20:54,  1.17s/it] 15%|█▍        | 182/1250 [03:28<20:48,  1.17s/it] 15%|█▍        | 183/1250 [03:29<20:47,  1.17s/it] 15%|█▍        | 184/1250 [03:30<21:12,  1.19s/it] 15%|█▍        | 185/1250 [03:32<21:11,  1.19s/it] 15%|█▍        | 186/1250 [03:33<21:02,  1.19s/it] 15%|█▍        | 187/1250 [03:34<20:44,  1.17s/it] 15%|█▌        | 188/1250 [03:35<20:32,  1.16s/it] 15%|█▌        | 189/1250 [03:36<20:49,  1.18s/it] 15%|█▌        | 190/1250 [03:37<20:24,  1.16s/it] 15%|█▌        | 191/1250 [03:38<20:08,  1.14s/it] 15%|█▌        | 192/1250 [03:40<19:57,  1.13s/it] 15%|█▌        | 193/1250 [03:41<19:45,  1.12s/it] 16%|█▌        | 194/1250 [03:42<19:40,  1.12s/it] 16%|█▌        | 195/1250 [03:43<19:35,  1.11s/it] 16%|█▌        | 196/1250 [03:44<19:35,  1.12s/it] 16%|█▌        | 197/1250 [03:45<19:42,  1.12s/it] 16%|█▌        | 198/1250 [03:46<20:07,  1.15s/it] 16%|█▌        | 199/1250 [03:48<20:08,  1.15s/it] 16%|█▌        | 200/1250 [03:49<20:13,  1.16s/it] 16%|█▌        | 201/1250 [03:50<20:17,  1.16s/it] 16%|█▌        | 202/1250 [03:51<20:06,  1.15s/it] 16%|█▌        | 203/1250 [03:52<19:51,  1.14s/it] 16%|█▋        | 204/1250 [03:53<19:42,  1.13s/it] 16%|█▋        | 205/1250 [03:54<19:46,  1.14s/it] 16%|█▋        | 206/1250 [03:55<19:48,  1.14s/it] 17%|█▋        | 207/1250 [03:57<19:39,  1.13s/it] 17%|█▋        | 208/1250 [03:58<19:34,  1.13s/it] 17%|█▋        | 209/1250 [03:59<19:30,  1.12s/it] 17%|█▋        | 210/1250 [04:00<19:25,  1.12s/it] 17%|█▋        | 211/1250 [04:01<19:19,  1.12s/it] 17%|█▋        | 212/1250 [04:02<19:14,  1.11s/it] 17%|█▋        | 213/1250 [04:03<19:09,  1.11s/it] 17%|█▋        | 214/1250 [04:04<19:07,  1.11s/it] 17%|█▋        | 215/1250 [04:05<19:10,  1.11s/it] 17%|█▋        | 216/1250 [04:07<19:07,  1.11s/it] 17%|█▋        | 217/1250 [04:08<19:04,  1.11s/it] 17%|█▋        | 218/1250 [04:09<19:01,  1.11s/it] 18%|█▊        | 219/1250 [04:10<19:03,  1.11s/it] 18%|█▊        | 220/1250 [04:11<19:02,  1.11s/it] 18%|█▊        | 221/1250 [04:12<19:22,  1.13s/it] 18%|█▊        | 222/1250 [04:13<19:20,  1.13s/it] 18%|█▊        | 223/1250 [04:14<19:14,  1.12s/it] 18%|█▊        | 224/1250 [04:16<19:58,  1.17s/it] 18%|█▊        | 225/1250 [04:17<19:55,  1.17s/it]Traceback (most recent call last):
  File "run.py", line 229, in <module>
    run(get_options())
  File "run.py", line 204, in run
    start_time
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/train.py", line 78, in train_epoch
    size=opts.graph_size, num_samples=opts.epoch_size, distribution=opts.data_distribution))
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/reinforce_baselines.py", line 45, in wrap_dataset
    return self.baseline.wrap_dataset(dataset)
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/reinforce_baselines.py", line 179, in wrap_dataset
    return BaselineDataset(dataset, rollout(self.model, dataset, self.opts).view(-1, 1))
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/train.py", line 44, in rollout
    in tqdm(DataLoader(dataset, batch_size=opts.eval_batch_size), disable=opts.no_progress_bar)
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/train.py", line 43, in <listcomp>
    for bat
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/train.py", line 38, in eval_model_bat
    cost, _ = model(move_to(bat, opts.device))
  File "/anaconda3/lib/python3.7/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/nets/attention_model.py", line 138, in forward
    _log_p, pi = self._inner(input, embeddings)
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/nets/attention_model.py", line 253, in _inner
    log_p, mask = self._get_log_p(fixed, state)
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/nets/attention_model.py", line 359, in _get_log_p
    log_p, glimpse = self._one_to_many_logits(query, glimpse_K, glimpse_V, logit_K, mask)
  File "/Users/yu/Documents/Duke/courses/capstone/RL_for_vehicle/repository_modified/garage_attention/garage_attention/nets/attention_model.py", line 478, in _one_to_many_logits
    logits = torch.matmul(final_Q, logit_K.transpose(-2, -1)).squeeze(-2) / math.sqrt(final_Q.size(-1))
KeyboardInterrupt
